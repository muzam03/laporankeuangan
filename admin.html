<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Keuangan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-100 font-sans min-h-screen">

    <div id="loginArea" class="flex items-center justify-center h-screen w-full">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-96 border-t-4 border-blue-600">
            <div class="text-center mb-6">
                <i class="fas fa-lock text-4xl text-blue-600 mb-2"></i>
                <h2 class="text-2xl font-bold text-gray-800">Admin Login</h2>
            </div>
            
            <form id="formLogin">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Username</label>
                    <input type="text" id="userInput" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50" placeholder="Masukkan Username..." required>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Password</label>
                    <input type="password" id="passInput" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50" placeholder="Masukkan Password..." required>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition transform active:scale-95 shadow-lg">
                    MASUK SISTEM
                </button>
                <p id="errorMsg" class="text-red-500 text-sm mt-4 text-center hidden bg-red-100 p-2 rounded border border-red-300">
                    <i class="fas fa-exclamation-circle"></i> Username / Password Salah!
                </p>
            </form>

            <div class="mt-6 text-center border-t pt-4">
                <a href="index.html" class="text-sm text-gray-500 hover:text-blue-600 flex items-center justify-center gap-2">
                    <i class="fas fa-arrow-left"></i> Kembali ke Laporan Publik
                </a>
            </div>
        </div>
    </div>

    <div id="adminArea" class="hidden pb-10">
        
        <nav class="bg-blue-800 text-white p-4 shadow-lg sticky top-0 z-50">
            <div class="container mx-auto flex justify-between items-center">
                <div class="font-bold text-lg flex items-center gap-2">
                    <i class="fas fa-cogs"></i> Panel Administrator
                </div>
                <div class="flex items-center gap-4">
                    <a href="index.html" target="_blank" class="text-blue-200 hover:text-white text-sm">
                        <i class="fas fa-external-link-alt"></i> Lihat Web
                    </a>
                    <button onclick="logout()" class="bg-red-500 px-4 py-2 rounded text-sm font-bold hover:bg-red-600 shadow">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </nav>

        <div class="container mx-auto p-4 grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6">
            
            <div class="bg-white shadow-lg rounded-xl p-6 h-fit border border-gray-200">
                <h3 class="font-bold text-lg mb-4 text-gray-700 border-b pb-2">
                    <i class="fas fa-plus-circle text-green-600"></i> Input Transaksi
                </h3>
                <form id="formTransaksi">
                    <div class="mb-3">
                        <label class="text-xs font-bold text-gray-600 uppercase">Tanggal</label>
                        <input type="date" id="tanggal" class="w-full border border-gray-300 p-2 rounded focus:ring-2 focus:ring-green-500 outline-none" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="text-xs font-bold text-gray-600 uppercase">Jenis Transaksi</label>
                        <div class="relative">
                            <select id="jenis" class="w-full border border-gray-300 p-2 rounded appearance-none focus:ring-2 focus:ring-green-500 outline-none">
                                <option value="Masuk">Pemasukan (Uang Masuk)</option>
                                <option value="Keluar">Pengeluaran (Uang Keluar)</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                <i class="fas fa-chevron-down text-xs"></i>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="text-xs font-bold text-gray-600 uppercase">Nama Barang / Keterangan</label>
                        <input type="text" id="namaBarang" class="w-full border border-gray-300 p-2 rounded focus:ring-2 focus:ring-green-500 outline-none" placeholder="Contoh: Nasi Goreng" required>
                    </div>

                    <div class="flex gap-3 mb-6">
                        <div class="w-1/2">
                            <label class="text-xs font-bold text-gray-600 uppercase">Harga Satuan</label>
                            <input type="number" id="harga" class="w-full border border-gray-300 p-2 rounded focus:ring-2 focus:ring-green-500 outline-none" placeholder="Rp" required>
                        </div>
                        <div class="w-1/2">
                            <label class="text-xs font-bold text-gray-600 uppercase">Qty (Jumlah)</label>
                            <input type="number" id="qty" value="1" class="w-full border border-gray-300 p-2 rounded focus:ring-2 focus:ring-green-500 outline-none" required>
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 shadow transition flex justify-center items-center gap-2">
                        <i class="fas fa-save"></i> SIMPAN DATA
                    </button>
                </form>
            </div>

            <div class="bg-white shadow-lg rounded-xl p-6 lg:col-span-2 border border-gray-200">
                <div class="flex flex-col md:flex-row justify-between items-center mb-4 border-b pb-4 gap-3">
                    <h3 class="font-bold text-lg text-gray-700">Database Transaksi</h3>
                    
                    <div class="flex gap-2">
                        <button onclick="exportData()" class="text-xs bg-indigo-100 text-indigo-700 px-3 py-2 rounded-lg font-bold hover:bg-indigo-200 border border-indigo-200 flex items-center gap-1 transition">
                            <i class="fas fa-file-export"></i> Backup (Salin)
                        </button>
                        <button onclick="importData()" class="text-xs bg-orange-100 text-orange-700 px-3 py-2 rounded-lg font-bold hover:bg-orange-200 border border-orange-200 flex items-center gap-1 transition">
                            <i class="fas fa-file-import"></i> Restore (Tempel)
                        </button>
                        <button onclick="hapusSemua()" class="text-xs bg-red-100 text-red-600 px-3 py-2 rounded-lg font-bold hover:bg-red-200 border border-red-200 flex items-center gap-1 ml-2 transition">
                            <i class="fas fa-trash"></i> Reset
                        </button>
                    </div>
                </div>

                <div class="overflow-x-auto max-h-[500px] overflow-y-auto pr-2 custom-scrollbar">
                    <table class="min-w-full text-sm text-left">
                        <thead class="bg-gray-100 text-gray-600 sticky top-0 z-10 shadow-sm">
                            <tr>
                                <th class="p-3 rounded-tl-lg">Tanggal</th>
                                <th class="p-3">Barang</th>
                                <th class="p-3 text-right">Total</th>
                                <th class="p-3 text-center rounded-tr-lg">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="tabelAdmin">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script>
        // --- 1. LOGIKA LOGIN ---
        document.getElementById('formLogin').addEventListener('submit', function(e) {
            e.preventDefault();
            const u = document.getElementById('userInput').value;
            const p = document.getElementById('passInput').value;

            // Kredensial Hardcode (Sederhana)
            if(u === 'muzam' && p === 'admin123') {
                document.getElementById('loginArea').classList.add('hidden');
                document.getElementById('adminArea').classList.remove('hidden');
                initAdmin(); 
            } else {
                const errMsg = document.getElementById('errorMsg');
                errMsg.classList.remove('hidden');
                // Efek getar sederhana
                document.querySelector('.bg-white.w-96').classList.add('animate-pulse');
                setTimeout(() => document.querySelector('.bg-white.w-96').classList.remove('animate-pulse'), 500);
            }
        });

        function logout() {
            location.reload(); 
        }

        // --- 2. LOGIKA ADMIN CRUD ---
        function initAdmin() {
            document.getElementById('tanggal').valueAsDate = new Date();
            renderAdminTable();
        }

        function renderAdminTable() {
            const db = getDatabase();
            const tbody = document.getElementById('tabelAdmin');
            tbody.innerHTML = '';

            if(db.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center py-4 text-gray-400">Database Kosong.</td></tr>';
                return;
            }

            // Loop biasa (agar index sesuai urutan untuk dihapus)
            // Kita tampilkan data terbaru di atas secara visual, tapi logic hapus pakai index asli
            // Agar mudah, kita loop terbalik manual atau pakai slice().reverse() tapi hati-hati indexnya.
            // Paling aman: Tampilkan sesuai urutan array (data baru di bawah) di tabel admin agar index konsisten.
            
            db.forEach((item, index) => {
                const total = item.harga * item.qty;
                const warna = item.jenis === 'Masuk' ? 'text-green-600' : 'text-red-600';
                
                tbody.innerHTML += `
                    <tr class="border-b hover:bg-gray-50 transition">
                        <td class="p-3 text-gray-600">${item.tanggal}</td>
                        <td class="p-3">
                            <div class="font-bold text-gray-800">${item.namaBarang}</div>
                            <div class="text-xs text-gray-500">${item.qty} x ${formatRupiah(item.harga)}</div>
                        </td>
                        <td class="p-3 text-right font-bold ${warna}">
                            ${formatRupiah(total)}
                        </td>
                        <td class="p-3 text-center">
                            <button onclick="hapusSatu(${index})" class="bg-white border border-red-200 text-red-500 p-2 rounded-lg hover:bg-red-500 hover:text-white transition shadow-sm" title="Hapus">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
        }

        // Simpan Data
        document.getElementById('formTransaksi').addEventListener('submit', function(e) {
            e.preventDefault();
            const db = getDatabase();
            
            const dataBaru = {
                id: Date.now(),
                tanggal: document.getElementById('tanggal').value,
                jenis: document.getElementById('jenis').value,
                namaBarang: document.getElementById('namaBarang').value,
                harga: parseInt(document.getElementById('harga').value),
                qty: parseInt(document.getElementById('qty').value)
            };

            db.push(dataBaru); // Tambah ke array
            saveDatabase(db);  // Simpan ke localstorage
            
            this.reset();
            document.getElementById('tanggal').valueAsDate = new Date();
            renderAdminTable();
            
            // Alert kecil tanpa block
            const btn = document.querySelector('button[type="submit"]');
            const oriText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i> Tersimpan!';
            btn.classList.replace('bg-green-600', 'bg-blue-600');
            setTimeout(() => {
                btn.innerHTML = oriText;
                btn.classList.replace('bg-blue-600', 'bg-green-600');
            }, 1500);
        });

        // Hapus Satu
        window.hapusSatu = function(index) {
            if(confirm('Yakin ingin menghapus data transaksi ini?')) {
                const db = getDatabase();
                db.splice(index, 1);
                saveDatabase(db);
                renderAdminTable();
            }
        }

        // Hapus Semua
        window.hapusSemua = function() {
            if(confirm('PERINGATAN KERAS:\nSemua data akan dihapus permanen!\nLanjutkan?')) {
                localStorage.removeItem(DB_KEY);
                renderAdminTable();
            }
        }

        // --- 3. FITUR BACKUP & RESTORE (PINDAH DATA) ---
        
        window.exportData = function() {
            const db = localStorage.getItem(DB_KEY);
            if (!db || db === '[]') {
                alert('Tidak ada data untuk dibackup.');
                return;
            }
            
            // Copy ke clipboard
            navigator.clipboard.writeText(db).then(() => {
                alert('SUKSES MENYALIN DATA! \n\n1. Buka WhatsApp/Email.\n2. Paste (Tempel) kode tersebut.\n3. Kirim ke HP/Laptop tujuan.');
            }).catch(err => {
                prompt("Gagal copy otomatis. Silakan copy manual kode di bawah:", db);
            });
        }

        window.importData = function() {
            const dataString = prompt("Silakan PASTE (Tempel) kode data JSON di sini:");
            
            if (dataString) {
                try {
                    const json = JSON.parse(dataString);
                    if(!Array.isArray(json)) throw new Error();
                    
                    localStorage.setItem(DB_KEY, dataString);
                    alert('BERHASIL! Data telah dipulihkan. Web akan direfresh.');
                    location.reload();
                } catch (e) {
                    alert('ERROR: Format data salah atau kosong!');
                }
            }
        }
    </script>
</body>
</html>
